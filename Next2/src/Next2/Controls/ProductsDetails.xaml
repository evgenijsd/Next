<?xml version="1.0" encoding="UTF-8"?>
<Grid
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:xct="http://xamarin.com/schemas/2020/toolkit"
    xmlns:controls="clr-namespace:Next2.Controls"
    xmlns:models="clr-namespace:Next2.Models"
    xmlns:modelsApi="clr-namespace:Next2.Models.API.DTO"
    RowDefinitions="auto, auto"
    x:Class="Next2.Controls.ProductsDetails">

    <Grid.Resources>
        <Style x:Key="SeparatorThinnyStyle" TargetType="BoxView" BasedOn="{StaticResource SeparatorStyle_i1}">
            <Setter Property="VerticalOptions" Value="Start"/>
            <Setter Property="HeightRequest" Value="1"/>
        </Style>
    </Grid.Resources>

    <StackLayout
        Grid.Row="1" 
        BindableLayout.ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=ItemsSource}">

        <BindableLayout.ItemTemplate>

            <DataTemplate x:DataType="models:ProductBindableModel">

                <StackLayout>

                    <StackLayout IsVisible="{Binding AddedIngredients, Converter={xct:ListIsNotNullOrEmptyConverter}}">
                        
                        <BoxView Style="{DynamicResource SeparatorThinnyStyle}"/>

                        <StackLayout Orientation="Horizontal">

                            <Label
                                Text="{Binding Product.Name}"
                                TextColor="{DynamicResource AppColor_i1}"
                                FontSize="{DynamicResource TSize_i5}"
                                Margin="0, 10, 0, 0"/>

                            <Label 
                                Text="{Binding ProductPriceBaseOnProportion, StringFormat='$ {0:F2}'}"
                                Margin="0, 10, 0, 0"
                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizePrice}" 
                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyPrice}" 
                                TextColor="{DynamicResource IndicationColor_i1}"
                                HorizontalOptions="EndAndExpand">

                            </Label>

                        </StackLayout>

                        <Label 
                            Margin="0, 10, 0, 0"
                            VerticalOptions="Start"
                            Text="{xct:Translate Inventory}"
                            TextColor="{DynamicResource TextAndBackgroundColor_i9}"
                            FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeTitle}" 
                            FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyTitle}"/>

                        <StackLayout
                            BindableLayout.ItemsSource="{Binding AddedIngredients}"
                            Margin="0, 0, 0, 0">

                            <BindableLayout.ItemTemplate>

                                <DataTemplate x:DataType="modelsApi:SimpleIngredientModelDTO">
                                    
                                    <Grid 
                                        Grid.Row="1"
                                        ColumnDefinitions="0.50*, 0.50*"
                                        RowDefinitions="auto, auto">

                                        <StackLayout 
                                            Grid.Column="0"
                                            Grid.Row="1"
                                            VerticalOptions="Start"
                                            Orientation="Vertical">

                                            <Label 
                                                Text="{Binding Name}"
                                                Margin="0, 5, 0, 0"
                                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeProduct}" 
                                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyProduct}" 
                                                TextColor="{DynamicResource TextAndBackgroundColor_i1}"/>

                                        </StackLayout>

                                        <StackLayout 
                                            Grid.Column="1"
                                            Grid.Row="1"
                                            HorizontalOptions="EndAndExpand"
                                            Orientation="Vertical">

                                            <Label 
                                                Text="{Binding Price, StringFormat='$ {0:F2}'}"
                                                Margin="0, 5, 0, 0"
                                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizePrice}" 
                                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyPrice}" 
                                                TextColor="{DynamicResource IndicationColor_i1}">

                                            </Label>

                                        </StackLayout>

                                    </Grid>

                                </DataTemplate>

                            </BindableLayout.ItemTemplate>

                        </StackLayout>

                        <StackLayout BindableLayout.ItemsSource="{Binding ExcludedIngredients}">

                            <BindableLayout.ItemTemplate>

                                <DataTemplate x:DataType="modelsApi:SimpleIngredientModelDTO">
                                    
                                    <Grid 
                                        Grid.Row="1"
                                        ColumnDefinitions="0.50*, 0.50*"
                                        RowDefinitions="auto, auto">

                                        <StackLayout 
                                            Grid.Column="0"
                                            Grid.Row="1"
                                            VerticalOptions="Start"
                                            Orientation="Vertical">

                                            <Label 
                                                Text="{Binding Name}"
                                                Margin="0, 5, 0, 0"
                                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeProduct}" 
                                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyProduct}" 
                                                TextColor="{DynamicResource TextAndBackgroundColor_i1}"/>

                                        </StackLayout>

                                        <StackLayout 
                                            Grid.Column="1"
                                            Grid.Row="1"
                                            HorizontalOptions="EndAndExpand"
                                            Orientation="Vertical">

                                            <Label 
                                                Text="{Binding Price, StringFormat='$ {0:F2}'}"
                                                Margin="0, 5, 0, 0"
                                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizePrice}" 
                                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyPrice}" 
                                                TextColor="{DynamicResource IndicationColor_i3}">

                                            </Label>

                                        </StackLayout>

                                    </Grid>

                                </DataTemplate>

                            </BindableLayout.ItemTemplate>

                        </StackLayout>

                    </StackLayout>
      
                    <Grid
                        Grid.Row="1"
                        Margin="0, 10, 0, 10"
                        ColumnDefinitions="0.50*, 0.50*"
                        RowDefinitions="auto, auto">
                        <!--IsVisible="{Binding   , Converter={xct:ListIsNotNullOrEmptyConverter}}"-->

                        <BoxView
                            Grid.ColumnSpan="2"
                            Style="{DynamicResource SeparatorThinnyStyle}"/>

                        <Label
                            Grid.Row="0"
                            Grid.Column="0"
                            Margin="0, 10, 0, 0"
                            VerticalOptions="Start"
                            Text="{xct:Translate Replace}"
                            FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeTitle}" 
                            FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyTitle}" 
                            TextColor="{DynamicResource TextAndBackgroundColor_i9}"/>

                        <StackLayout
                            Grid.Column="0"
                            Grid.Row="1"
                            VerticalOptions="Start"
                            Orientation="Vertical">

                            <Label
                                Margin="0, 5, 0, 0"
                                Text="{Binding Product.Name}"
                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeProduct}" 
                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyProduct}" 
                                TextColor="{DynamicResource TextAndBackgroundColor_i1}"/>

                        </StackLayout>

                        <StackLayout
                            Grid.Column="1"
                            Grid.Row="1"
                            HorizontalOptions="EndAndExpand"
                            Orientation="Vertical">

                            <Label
                                Margin="0, 5, 0, 0"
                                Text="{Binding Product.DefaultPrice, StringFormat='$ {0:F2}'}"
                                FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizePrice}" 
                                FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyPrice}" 
                                TextColor="{DynamicResource IndicationColor_i1}"/>

                        </StackLayout>

                    </Grid>

                    <StackLayout>

                        <BoxView Style="{DynamicResource SeparatorThinnyStyle}"/>

                        <Label
                            Margin="0, 10, 0, 0"
                            VerticalOptions="Start"
                            Text="{xct:Translate Option}"
                            FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeTitle}" 
                            FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyTitle}" 
                            TextColor="{DynamicResource TextAndBackgroundColor_i9}">
                            
                            <Label.Triggers>
                                
                                <DataTrigger TargetType="Label" Binding="{Binding Options}" Value="null">
                                    <Setter Property="IsVisible" Value="False"/>
                                </DataTrigger>

                            </Label.Triggers>
                            
                        </Label>

                        <Label
                            Margin="0, 5, 0, 10"
                            Text="{Binding SelectedOptions.Name}"
                            FontSize="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontSizeProduct}" 
                            FontFamily="{Binding Source={RelativeSource AncestorType={x:Type controls:ProductsDetails}}, Path=FontFamilyProduct}" 
                            TextColor="{DynamicResource TextAndBackgroundColor_i1}"/>

                    </StackLayout>

                </StackLayout>

            </DataTemplate>

        </BindableLayout.ItemTemplate>

    </StackLayout>

</Grid>