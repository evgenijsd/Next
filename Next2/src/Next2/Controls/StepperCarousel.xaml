<?xml version="1.0" encoding="UTF-8"?>
<StackLayout
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:behaviors="http://prismlibrary.com"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:xct="http://xamarin.com/schemas/2020/toolkit"
    xmlns:ffimageloading="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
    xmlns:controls="clr-namespace:Next2.Controls"
    xmlns:templates="clr-namespace:Next2.Controls.Templates"
    xmlns:effects="clr-namespace:Next2.Effects"
    xmlns:models="clr-namespace:Next2.Models"
    x:Class="Next2.Controls.StepperCarousel"
    MinimumHeightRequest="100"
    VerticalOptions="Start"
    Orientation="Horizontal"
    x:Name="stepperCarousel">

    <Frame
        HeightRequest="100"
        HasShadow="False"
        Padding="5"
        BackgroundColor="{DynamicResource TextAndBackgroundColor_i6}"
        BorderColor="{DynamicResource TextAndBackgroundColor_i2}"
        CornerRadius="5"
        xct:TouchEffect.Command="{Binding Source={RelativeSource AncestorType={x:Type controls:StepperCarousel}}, Path=TapLeftButtonCommand}">

        <ffimageloading:CachedImage Source="ic_arrow_left_24x24.png"/>

    </Frame>

    <CollectionView
        HorizontalOptions="StartAndExpand"
        HeightRequest="100"
        x:Name="collectionView"
        BackgroundColor="{DynamicResource TextAndBackgroundColor_i6}"
        VerticalScrollBarVisibility="Never"
        HorizontalScrollBarVisibility="Never"
        ItemsSource="{Binding Source={RelativeSource AncestorType={x:Type controls:StepperCarousel}}, Path=ItemsSource}">

        <CollectionView.Effects>
            
            <effects:NoOverScrollEffect/>
            
        </CollectionView.Effects>

        <CollectionView.Behaviors>

            <behaviors:EventToCommandBehavior
                Command="{Binding ScrolledCommand, Source={x:Reference stepperCarousel}}"
                EventName="Scrolled"
                EventArgsParameterPath="FirstVisibleItemIndex"/>

        </CollectionView.Behaviors>

        <CollectionView.ItemsLayout>

            <GridItemsLayout
                Orientation="Horizontal"
                Span="2"
                SnapPointsType="Mandatory" 
                SnapPointsAlignment="Start"/>

        </CollectionView.ItemsLayout>

        <CollectionView.ItemTemplate>

            <DataTemplate x:DataType="models:CategoryModel">

                <ContentView Padding="5">

                    <templates:CategoryItemTemplate
                        WidthRequest="135"
                        HeightRequest="45"
                        HasShadow="False"
                        CornerRadius="10"
                        Padding="5"
                        State="{Binding Id}"
                        BindableState="{Binding SelectedItemIndex, Source={x:Reference stepperCarousel}}"
                        Text="{Binding Title}"/>

                </ContentView>

            </DataTemplate>

        </CollectionView.ItemTemplate>

    </CollectionView>
    
    <Frame
        HeightRequest="100"
        HasShadow="False"
        Padding="5"
        BackgroundColor="{DynamicResource TextAndBackgroundColor_i6}"
        BorderColor="{DynamicResource TextAndBackgroundColor_i2}"
        CornerRadius="5"
        xct:TouchEffect.Command="{Binding Source={RelativeSource AncestorType={x:Type controls:StepperCarousel}}, Path=TapRightButtonCommand}">

        <ffimageloading:CachedImage Source="ic_arrow_right_24x24.png"/>

    </Frame>

</StackLayout>